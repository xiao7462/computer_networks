# computer_networks

# 目录

-[TCP/IP](#TCP/IP)
 -[IP](#IP)

# TCP/IP

-   什么是面向无连接/面向有连接
    
    1.  面向无连接： 不需要建立和断开连接。 发射端可以在任何时候自由发送数据，接受不知道自己从哪里接受数据，即使接收端不存在或者无法接受数据，发射端也能将数据发送出去。有点像广播喇叭，就算是没人听也会一直播报。 UDP协议， IP 就是一中无连接协议
        
    2.  面向有连接： 传送数据前需要先建立连接，其中包括了3个过程： 建立连接，使用连接，释放连接，TCP协议就是一个面向连接的协议。 有点像电话系统。
        

-   TCP是什么
    
    TCP是一种面向连接的，可靠的，基于字节流的传输层通信协议。 TCP协议需要经过过*创建连接*，*数据传输*，*终止连接*3个步骤
    
-   TCP 的特点
    
    1.  TCP是面向连接的： 通讯双方要先建立起连接才能进行数据的传输，且连接是一对一的
        
-   TCP为什么可靠
    
    1.  **TCP采用发送应答机制**： 发送端发出的每个报文段都必须得到接受方的应答才认为这个TCP报文段传输成功
        
    2.  **超时重传**： 发送端发出一个报文段之后就启动定时器，如果定时时间内没有收到应答就重新发送这个报文段
        
    3.  **错误校验**： TCP在发送和接受时都要计算校验
        
    4.  **流量控制和阻塞管理**
        
-   TCP和UDP的区别
    
    1.  TCP是面向连接，可靠的数据传输， UDP是非面向连接的，不可靠的
        
    2.  TCP传输的数据可靠，能够无差错，不丢失，不重复，按序到达。 UDP不能
        
    3.  TCP面向字节流， UDP面向报文
        
    4.  TCP连接是点到点的， UDP是一对一，一对多，多对多的交互通信
        
-   TCP 三次握手
    
    三次握手就是建立一个TCP连接时， 需要客户端和服务端总共发送3个包用来确认连接的建立。
    
    ![3次挥手.png](https://i.loli.net/2019/08/29/qzi6QRtUnKHp4ma.png)
    ![ack.png](https://i.loli.net/2019/08/29/5HyLUPOvfRZk9Gc.png)
    
    > 第一次握手： 客户端将SYN(连接请求)设置为1， 随机产生一个值seq = J , 并将该数据包发送给Server, Client进入SYN_SENT状态 ，等待Server确认
    
    > 第二次握手： Server 标志位置SYN和ACK（确认） 都设置为1 ，ack（确认号）= J+1， 随机产生一个seq（报文序号） = K, 并将该数据包发送给Client以确认请求， Server进入SYB_RCVD状态
    
    > 第三次握手： Client 收到确认瘦， 检查ack是否为J+1， ACK是否为1， 如果正确，则将ack = K+1 和ACK = 1发送给Server， 如果正确则建立连接成功， Client和Server进入ESTABLISHED状态，完成3次握手
    
    为什么不是2,4,5次握手
    
    > 如果是2次握手， 那在服务器在第二次握手时发送数据，此时服务器认为连接已经建立， 但在发送数据过程中丢失， 客户端认为没有建立， 会进行重传。 假设每次发送的数据都一直在丢失，客户端一直SYN（请求连接）， 服务器就会产生多个无效连接，占用资源，这时候服务器就会挂掉
    > 
    > 第三次握手时为了防止： 如果客户端迟迟没有收到服务器返回确认的报文，这时会重新启动一条连接请求， 但是服务器不知道客服端没有收到，所以客服端会收到2个连接，浪费开销
    
-   TCP 4次挥手
    
    ![4.png](https://i.loli.net/2019/08/29/QHvTuEXM96IzC2r.png)
    

1）客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。 TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。
2）服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。
3）客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。
4）服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。
5）客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，必须经过2∗∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。
6）服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。

-   为什么连接是3次握手， 关闭是4次握手？
    
    因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，"你发的FIN报文我收到了"。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。
    
-   为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？
    
    虽然按道理，四个报文都发送完毕，我们可以直接进入CLOSE状态了，但是我们必须假象网络是不可靠的，有可以最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。在Client发送出最后的ACK回复，但该ACK可能丢失。Server如果没有收到ACK，将不断重复发送FIN片段。所以Client不能立即关闭，它必须确认Server接收到了该ACK。Client会在发送出ACK之后进入到TIME_WAIT状态。Client会设置一个计时器，等待2MSL的时间。如果在该时间内再次收到FIN，那么Client会重发ACK并再次等待2MSL。所谓的2MSL是两倍的MSL(Maximum Segment Lifetime)。MSL指一个片段在网络中最大的存活时间，2MSL就是一个发送和一个回复所需的最大时间。如果直到2MSL，Client都没有再次收到FIN，那么Client推断ACK已经被成功接收，则结束TCP连接。
    
-   如果已经建立了连接，但是客户端突然出现故障了怎么办？
    

        TCP还设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为2小时，若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75秒钟发送一次。若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。

# UDP

UDP是一种无连接的数据传输协议 。特点是传输时数据包丢失会比较严重，通常音频，视频，普通数据传送会使用UDP

# IP

1.  TCP/IP协议体系的认知
    
2.  链路层
    
3.  以太网帧的格式
    
4.  MTU的概念
    
5.  ARP协议和RARP协议（掌握一下ARP缓存的原理）
    
6.  网络层
    
7.  掌握IP的首部格式
    
8.  掌握IP的分片
    
9.  掌握IP选路
    
10.  ICMP协议
    
11.  掌握报文格式
    
12.  分类：查询 + 差错
    
13.  两种 + 五种
    
14.  传输层
    
15.  UDP，次要一点，掌握特点和首部各个字段
    
16.  掌握TCP
    
17.  特点 + 首部字段 + 可靠机制
    
18.  连接控制 ： 三次握手，四次挥手，同时打开，同时关闭，半关闭（可能问到为什么需要）
    
19.  流量控制机制：滑动窗口,慢启动，拥塞避免，快速重传，快速恢复
    
20.  超时重传机制
    
21.  应用层
    
22.  掌握DNS协议
    
23.  名字空间
    
24.  指针查询（反向查找或逆向解析）基本原理
    
25.  DNS缓存
    
26.  FTP协议（活化石）：
    
27.  控制流和数据流
    
28.  两种工作模式： PASV 和 PORT
    
29.  各种指令和响应码
    
30.  断点续传和匿名FTP的概念
    
31.  HTTP协议：
    
32.  报文格式：请求报文，响应报文，请求头各种字段，响应头各种字段
    
33.  HTTP状态码
    
34.  HTTPS协议
    
35.  握手的详细过程
    
36.  摘要算法，数字签名，数字证书的原理和过程
